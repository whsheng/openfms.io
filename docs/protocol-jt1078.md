# JT1078 音视频协议规范

> 文档创建时间: 2026-02-04
> 适用版本: v1.2+

---

## 一、协议概述

JT1078 是《道路运输车辆卫星定位系统 视频通信协议》，是 JT808 协议的扩展，用于音视频流传输。

### 与 JT808 的关系
- JT808: 位置、报警、指令等数据
- JT1078: 音视频流数据
- 两者共用 SIM 卡号作为设备标识

---

## 二、协议特点

### 2.1 数据包结构
```
+--------+--------+--------+--------+--------+--------+--------+--------+
| 标识位 | 版本号 | 会话ID | 数据类型 | 分包标记 | 数据长度 | 数据体  |
| 1字节  | 1字节  | 4字节  | 1字节   | 1字节   | 2字节   | N字节  |
+--------+--------+--------+--------+--------+--------+--------+--------+
```

### 2.2 数据类型
| 值 | 含义 |
|----|------|
| 0x00 | 音视频头 |
| 0x01 | 视频I帧 |
| 0x02 | 视频P帧 |
| 0x03 | 视频B帧 |
| 0x04 | 音频帧 |
| 0x05 | 音视频透传 |

### 2.3 视频编码
- H.264 (主流)
- H.265 (部分新设备)

### 2.4 音频编码
- G.711A
- G.711U
- AAC

---

## 三、通信流程

### 3.1 视频播放流程
```
1. 前端请求播放视频
2. API服务发送指令到设备 (JT808 0x9101)
3. 设备建立TCP连接到流媒体服务器
4. 设备发送RTP/RTMP流到流媒体服务器
5. 前端播放器从流媒体服务器拉流
6. 播放结束，发送停止指令 (JT808 0x9102)
```

### 3.2 指令列表
| 指令 | 功能 |
|------|------|
| 0x9101 | 实时音视频传输请求 |
| 0x9102 | 音视频实时传输控制 |
| 0x9201 | 回放请求 |
| 0x9202 | 回放控制 |
| 0x9301 | 语音对讲请求 |

---

## 四、架构设计

### 4.1 视频流旁路设计
```
┌─────────┐     ┌─────────┐     ┌─────────────┐     ┌─────────┐
│  前端    │────→│ API服务 │────→│  设备网关    │────→│  设备   │
│ (Web)   │     │ (Go)    │     │   (JT808)   │     │(GPS终端)│
└────┬────┘     └─────────┘     └─────────────┘     └────┬────┘
     │                                                    │
     │  2. WebRTC/FLV播放                                  │ 3. RTP推流
     │                                                    │
     ↓                                                    ↓
┌─────────────────────────────────────────────────────────────┐
│                    流媒体服务器 (ZLMediaKit)                  │
│              - RTMP/RTSP/WebRTC 输入输出                      │
│              - 转码、录制、截图                               │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 设计原则
- **信令与媒体分离**: 控制信令走 JT808，媒体流直连流媒体
- **不经过Go网关**: 视频流不经过Go编写的网关，降低复杂度
- **可扩展**: 支持多种流媒体服务器 (ZLMediaKit/SRS)

---

## 五、实现要点

### 5.1 设备端配置
设备需要配置流媒体服务器地址：
```
服务器IP: ZLMediaKit所在服务器IP
服务器端口: 默认554 (RTSP) 或 1935 (RTMP)
```

### 5.2 流地址格式
```
RTMP: rtmp://server-ip/live/stream_{sim_no}_{channel}
RTSP: rtsp://server-ip/live/stream_{sim_no}_{channel}
WebRTC: webrtc://server-ip/live/stream_{sim_no}_{channel}
FLV: http://server-ip/live/stream_{sim_no}_{channel}.flv
HLS: http://server-ip/live/stream_{sim_no}_{channel}/live.m3u8
```

### 5.3 端口规划
| 端口 | 用途 |
|------|------|
| 554 | RTSP 服务 |
| 1935 | RTMP 服务 |
| 8080 | HTTP-FLV/WebRTC |
| 8443 | HTTPS 服务 |
| 10000/UDP | WebRTC UDP 端口范围 |

---

## 六、参考资料

- [JT1078-2016 标准文档](http://www.mot.gov.cn/)
- [ZLMediaKit 文档](https://github.com/ZLMediaKit/ZLMediaKit)
- [SRS 文档](https://ossrs.net/)
